# Установка переменных сборки

## Хост и цель

Напомним вам, что такое хост-компьютер и целевой компьютер. *Хост-компьютер* (host) — это ПК, на котором вы собираете кросс-компилятор и прочие вещи. А *целевой компьютер* (target) — тот ПК, для которого вы это собираете. В данном руководстве хост-компьютером является компьютер на архитектуре x86_64, а целевым — компьютер на архитектуре AArch64.

## Установка дополнительных переменных окружения

> То, что это *дополнительные* переменные окружения, совсем не значит, что они являются *необязательными*. Мы вынесли объявление этих переменных окружения в отдельную страницу потому, что на [предыдущей странице](set-env.md) шла речь об общих переменных окружения. Переменные же на текцщей странице предназначены исключительно для сборки ПО. Кроме того, если для общих переменных существует один единственный шаблон, который можно использовать для всех сборок LFA, то значения для переменных на данной странице пользователь выбирает самостоятельно в зависимости от оборудования, для которого он собирает эту систему.

Для сборки кросс-компилятора вам нужно задать несколько переменных, которые будут зависеть от того, для какого оборудования вы хотите собрать LFA. Вам нужно выбрать триплет для целевой архитектуры, архитектуру процессора и т.д. Для выбора нужных значений пользуйтесь приведёнными на данной странице таблицами.

> Если ваш процессор — ARM9, хорошие варианты: триплет из `arm-linux-musleabi`, архитектура — `armv5t` и поддержка плавающей запятой — `soft`. ARM9-процессоры обычно не имеют аппаратных возможностей работы с плавающей запятой.
>
> Если же ваш процессор Cortex-A[^1], то, возможно, он имеет аппаратную возможность работы с плавающей запятой, поэтому хорошие варианты такие: триплет из `arm-linux-musleabihf`, архитектура `armv7-a` или `armv8-a`, поддержка плавающей запятой — `hard` и FPU — `vfpv3-d16` или `vfpv4`.
>
> ---
>
> [^1]: В данном руководстве рекомендуется собирать систему именно для таких процессоров.

Если ваш целевой процессор имеет аппаратную поддержку плавающей запятой, то установите переменную `LFA_FLOAT` в значение `hard` или `softfp`. Используйте `softfp`, если в будущем вы будете использовать в собранной системе ещё и программы, скомпилированные с помощью `soft`. В противном случае используйте `hard`. Если ваш целевой процессор не поддерживает плавающую запятую, используйте в качестве значения `LFA_FLOAT` `soft`:

```bash
export LFA_FLOAT="[hard, soft или softfp]"
```

Если вы выбрали `hard` или `softfp` для `LFA_FLOAT`, то теперь вам нужно установить, какое [оборудование для работы с плавающей запятой](../additional/fpu.md) используется в целевом процессоре (согласно таблице ниже):

```bash
export LFA_FPU="одно из значений из таблицы ниже"
```

| FPU | FPU | FPU | FPU |
|-----|-----|-----|-----|
| `fpa` | `fpe2` | `fpe3` | `maverick` |
| `vfp` | `vfpv3` | `vfpv3-fp16` | `vfpv3-d16` |
| `vfpv3-d16-fp16` | `vfpv3xd` | `vfpv3xd-fp16` | `neon` |
| `neon-fp16` | `vfpv4` | `vfpv4-d16` | `fpv4-sp-d16` |
| `neon-vfpv4` | | | | |

Например, для процессоров Cortex-A53 используется VFPv4.

Установите триплеты для хоста и целевой машины:

```bash
export LFA_HOST=$(echo ${MACHTYPE} | sed "s/-[^-]*/-cross/")
export LFA_TGT="триплет для целевой машины"
```

<!--
| Значение `$LFA_FLOAT` | Триплет                |
|-----------------------|------------------------|
| `soft` или `softfp`   | `arm-linux-musleabi`   |
| `hard`                | `arm-linux-musleabihf` | -->

| Значение `$LFA_FLOAT` | Триплет                    |
|-----------------------|----------------------------|
| `soft` или `softfp`   | `aarch64-linux-musleabi`   |
| `hard`                | `aarch64-linux-musleabihf` |

Выберите архитектуру, для которой будете собирать систему:

```bash
export LFA_ARCH="архитектура"
```

| ARCH | ARCH | ARCH | ARCH |
|------|------|------|------|
| `armv4t` | `armv5t` | `armv5te` | `armv6` |
| `armv6j` | `armv6k` | `armv6kz` | `armv6t2` |
| `armv6z` | `armv6-m` | `armv7` | `armv7-a` |
| `armv7-r` | `armv7-m` | `armv8-a` | `armv8-m` |
| `armv8-r` | `armv8.1-a` | `armv8.1-m` | `armv8.1-r` |
| `armv9-a` | `armv8` | `armv9` | |

Например, для процессоров Cortex-A53 `$LFA_ARCH="armv8-a"`.

Запишите эти переменные в `~/.bashrc`, чтобы не вводить их значения каждый раз после входа от имени пользователя `lfa`:

```bash
cat >> ~/.bashrc << EOF
export LFA_HOST="$LFA_HOST"
export LFA_TGT="$LFA_TGT"
export LFA_ARCH="$LFA_ARCH"
export LFA_FLOAT="$LFA_FLOAT"
export LFA_FPU="$LFA_FPU"
EOF
```

~~~admonish warning title="Внимание"
> В настоящее время мы составляем [список процессоров](../appendix/computers.md) (бренд процессора, модель процессора, его архитектура и модели ПК, где он применяется), в котором будут указаны полные сведения о том, какие значения используются для переменных `LFA_FPU`, `LFA_ARCH` и `LFA_TGT`.

В случае, если вы собрали систему, используя определённые значения, то, пожалуйста, оставьте [запрос]() в нашем репозитории GitHub по этому поводу. Укажите бренд процессора, еего модель и его архитектуру, а также модель компьютера, для которого вы собирали систему. Кроме того, совсем не лишним будет, если вы укажете, как собралась ваша система: собралась ли она корректно или были всевозможные ошибки в процессе сборки или в процессе её функционирования.

**Пример такого запроса (issue):**

> # Сборка системы для компьютера Orange Pi 3 LTS
> - **Бренд процессора:** Allwinner
> - **Модель:** Allwinner H6
> - **Архитектура:** Cortex-A53 (AArch64)
> - **Статус сборки:** система собралась нормально
> - **Статус функционирования:** система работает корректно
> ## Значения переменных сборки
> ```bash
> LFA_TGT="..."
> LFA_FLOAT="hard"
> LFA_FPU="vfpv4"
> LFA_HOST="..."
> LFA_TGT="arm-linux-musleabihf"
> LFA_ARCH="armv8-a"
> ```
~~~
